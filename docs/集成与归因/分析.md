# 分析

本文介绍如何将订阅事件导出到对象存储（阿里云 OSS、Amazon S3），以及在 DingYue 后台完成集成所需的参数。

## 阿里云

您需要填写 endpoint、accessKey 和 accessSecret 三个参数。

### Endpoint

Endpoint 表示 OSS 对外服务的访问域名。OSS 以 HTTP RESTful API 的形式对外提供服务，不同地域、内外网使用不同域名（请以阿里云官方文档为准）。

### accessKey 与 accessSecret

1. 使用阿里云账号登录 RAM 控制台。
2. 在左侧导航栏，选择 身份管理 > 用户。
3. 打开目标 RAM 用户详情页。
4. 在 用户 AccessKey 区域，查看并复制访问密钥信息。

## Amazon S3

将订阅事件作为 .csv 文件保存到 Amazon S3。

### 设置集成

需要填写参数：`awsAccessKeyId`、`awsSecretAccessKey`、`region`。

![选择对象](/images/50.png)

### 创建 S3 参数

#### 1) 创建访问策略（Policy）

转到 AWS 控制台 IAM 策略面板并选择“创建策略”（`https://console.aws.amazon.com/iamv2/home#/policies`）。

![选择对象](/images/51.png)

在策略编辑器中粘贴以下 JSON，并将示例存储桶名称替换为您的实际 S3 存储桶名称：

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowListObjectsInBucket",
      "Effect": "Allow",
      "Action": "s3:ListBucket",
      "Resource": "arn:aws:s3:::adapty-s3-integration-test"
    },
    {
      "Sid": "AllowAllObjectActions",
      "Effect": "Allow",
      "Action": "s3:*Object",
      "Resource": [
        "arn:aws:s3:::adapty-s3-integration-test/*",
        "arn:aws:s3:::adapty-s3-integration-test"
      ]
    },
    {
      "Sid": "AllowBucketLocation",
      "Effect": "Allow",
      "Action": "s3:GetBucketLocation",
      "Resource": "arn:aws:s3:::adapty-s3-integration-test"
    }
  ]
}
```
![选择对象](/images/52.png)


可添加标签（可选），命名策略并创建。

![选择对象](/images/53.png)


#### 2) 创建 IAM 用户并授予策略

1. 访问 `https://console.aws.amazon.com/iamv2/home#/users`，单击 创建用户。
![选择对象](/images/54.png)

2. 命名用户，选择“访问密钥 - 编程访问”，继续。
![选择对象](/images/55.png)

3. 选择“将用户添加到组”，创建组并关联上一步创建的策略。
![选择对象](/images/56.png)
![选择对象](/images/57.png)

4. 完成后创建用户，下载 .csv 或从面板复制密钥参数，并将其填入 DingYue。

![选择对象](/images/58.png)
![选择对象](/images/59.png)
![选择对象](/images/60.png)